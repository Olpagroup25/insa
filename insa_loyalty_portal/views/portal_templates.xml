<odoo>

    <!-- ===================================================
         SIDEBAR: Mejorar tarjetas de fidelidad en /my
         =================================================== -->
    <template id="loyalty_buttons_override"
              inherit_id="loyalty.loyalty_buttons"
              name="INSA: Tarjetas de fidelidad mejoradas">
        <xpath expr="//div[hasclass('o_loyalty_container')]" position="replace">
            <div class="o_loyalty_container insa-loyalty-sidebar">
                <div t-foreach="cards_per_programs"
                     t-as="program"
                     class="portal-loyalty-buttons cursor-pointer">
                    <div t-att-data-card_id="card.id"
                         t-foreach="cards_per_programs[program]"
                         t-as="card"
                         class="o_loyalty_card insa-loyalty-sidebar-card my-2">
                        <div class="insa-sidebar-card-accent"/>
                        <div class="insa-sidebar-card-body">
                            <div class="d-flex align-items-center gap-3">
                                <div class="insa-sidebar-card-icon">
                                    <img class="img-fluid"
                                         t-attf-src="/loyalty/static/src/img/{{ program.program_type }}.svg"
                                         width="36"/>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="insa-sidebar-card-title">
                                        <strong t-out="program.display_name"/>
                                    </div>
                                    <div class="insa-sidebar-card-points">
                                        ‚≠ê <t t-out="card.points_display"/>
                                    </div>
                                    <t t-if="program.program_type == 'loyalty' and any(reward.required_points &lt;= card.points for reward in program.reward_ids)">
                                        <div class="insa-sidebar-reward-badge">
                                            <i class="fa fa-gift me-1"/>¬°Ten√©s una recompensa disponible!
                                        </div>
                                    </t>
                                </div>
                                <div class="insa-sidebar-card-arrow">
                                    <i class="fa fa-chevron-right"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </xpath>
    </template>


    <!-- ===================================================
         HISTORIAL: Reemplazo completo del template
         (Los XPath no pueden entrar en slot de t-call)
         =================================================== -->
    <template id="loyalty_history_override"
              inherit_id="loyalty.loyalty_card_history_template"
              name="INSA: Historial de puntos mejorado">
        <!-- Reemplazar todo el contenido del template -->
        <xpath expr="//t[@t-call='portal.portal_layout']" position="replace">
            <t t-call="portal.portal_layout">
                <t t-set="breadcrumbs_searchbar" t-value="True"/>
                <t t-call="portal.portal_searchbar">
                    <t t-set="title">Historial de Transacciones</t>
                </t>
                <t t-if="not history_lines">
                    <div class="insa-loyalty-history-empty text-center py-5">
                        <div style="font-size: 3rem;">üìã</div>
                        <h5 class="mt-3">Sin transacciones</h5>
                        <p class="text-muted">
                            A√∫n no hay movimientos de puntos registrados para esta tarjeta.
                        </p>
                    </div>
                </t>
                <t t-else="" t-call="portal.portal_table">
                    <thead>
                        <tr class="active">
                            <th>Descripci√≥n</th>
                            <th>Orden</th>
                            <th>Fecha</th>
                            <th class="text-success">Emitidos</th>
                            <th class="text-danger">Usados</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="history_lines" t-as="line">
                            <td><span t-out="line.description"/></td>
                            <td t-if="line.order_id">
                                <t t-set="order_portal_url" t-value="line._get_order_portal_url()"/>
                                <t t-set="order_description" t-value="line._get_order_description()"/>
                                <a t-if="order_portal_url" t-att-href="order_portal_url">
                                    <t t-out="order_description"/>
                                </a>
                                <t t-else="">
                                    <t t-out="order_description"/>
                                </t>
                            </td>
                            <td t-else=""/>
                            <td><span t-out="line.create_date"/></td>
                            <td><span t-out="line.card_id._format_points(line.issued)"/></td>
                            <td><span t-out="line.card_id._format_points(line.used)"/></td>
                        </tr>
                    </tbody>
                </t>
            </t>
        </xpath>
    </template>


    <!-- ===================================================
         BREADCRUMBS: Traducir breadcrumbs
         Usamos XPath en el t-if espec√≠fico del loyalty
         =================================================== -->
    <template id="loyalty_breadcrumbs_override"
              inherit_id="loyalty.portal_loyalty_history_breadcrumbs"
              name="INSA: Breadcrumbs fidelidad">
        <xpath expr="//li[@t-if=&quot;page_name == 'loyalty_history'&quot;]" position="replace">
            <li class="breadcrumb-item" t-if="page_name == 'loyalty_history'">
                <span>Historial de Puntos</span>
            </li>
        </xpath>
    </template>

</odoo>
